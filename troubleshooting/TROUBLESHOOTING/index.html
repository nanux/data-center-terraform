<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=../../assets/logos/favicon.png><meta name=generator content="mkdocs-1.2.3, mkdocs-material-8.2.5"><title>Troubleshooting tips - Deployment Automation for Atlassian DC on Kubernetes</title><link rel=stylesheet href=../../assets/stylesheets/main.2d9f7617.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.e6a45f82.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-9EV9WQVD44"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&gtag("event","search",{search_term:this.value})}),"undefined"!=typeof location$&&location$.subscribe(function(e){gtag("config","G-9EV9WQVD44",{page_path:e.pathname})})})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-9EV9WQVD44"></script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary data-md-color-accent> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#troubleshooting-tips class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> <a href=https://community.atlassian.com/t5/Atlassian-Data-Center-on/gh-p/DC_Kubernetes title="Share your feedback with the Atlassian Data Center on Kubernetes Community" style=color:white><strong>Share your feedback and join the discussion</strong></a> </div> </aside> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Deployment Automation for Atlassian DC on Kubernetes" class="md-header__button md-logo" aria-label="Deployment Automation for Atlassian DC on Kubernetes" data-md-component=logo> <img src=../../assets/logos/atlassian-logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Deployment Automation for Atlassian DC on Kubernetes </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Troubleshooting tips </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary data-md-color-accent aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary data-md-color-accent aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/atlassian-labs/data-center-terraform/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> atlassian-labs/data-center-terraform </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../userguide/PREREQUISITES/ class=md-tabs__link> User guide </a> </li> <li class=md-tabs__item> <a href=./ class="md-tabs__link md-tabs__link--active"> Troubleshooting </a> </li> <li class=md-tabs__item> <a href=../../development/HOW_TO_START/ class=md-tabs__link> Development </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Deployment Automation for Atlassian DC on Kubernetes" class="md-nav__button md-logo" aria-label="Deployment Automation for Atlassian DC on Kubernetes" data-md-component=logo> <img src=../../assets/logos/atlassian-logo.svg alt=logo> </a> Deployment Automation for Atlassian DC on Kubernetes </label> <div class=md-nav__source> <a href=https://github.com/atlassian-labs/data-center-terraform/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> atlassian-labs/data-center-terraform </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> User guide <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="User guide" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> User guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../userguide/PREREQUISITES/ class=md-nav__link> Prerequisites </a> </li> <li class=md-nav__item> <a href=../../userguide/INSTALLATION/ class=md-nav__link> Installation </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_3 type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3> Configuration <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Configuration data-md-level=2> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> Configuration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../userguide/configuration/CONFIGURATION/ class=md-nav__link> Common configuration </a> </li> <li class=md-nav__item> <a href=../../userguide/configuration/BAMBOO_CONFIGURATION/ class=md-nav__link> Bamboo configuration </a> </li> <li class=md-nav__item> <a href=../../userguide/configuration/BITBUCKET_CONFIGURATION/ class=md-nav__link> Bitbucket configuration </a> </li> <li class=md-nav__item> <a href=../../userguide/configuration/CONFLUENCE_CONFIGURATION/ class=md-nav__link> Confluence configuration </a> </li> <li class=md-nav__item> <a href=../../userguide/configuration/JIRA_CONFIGURATION/ class=md-nav__link> Jira configuration </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../userguide/CLEANUP/ class=md-nav__link> Uninstallation </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3> Troubleshooting <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Troubleshooting data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Troubleshooting </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <a href=./ class="md-nav__link md-nav__link--active"> Troubleshooting tips </a> </li> <li class=md-nav__item> <a href=../SUPPORT_BOUNDARIES/ class=md-nav__link> Support boundaries </a> </li> <li class=md-nav__item> <a href=../LIMITATIONS/ class=md-nav__link> Limitations </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Development <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Development data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Development </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../development/HOW_TO_START/ class=md-nav__link> How to start development </a> </li> <li class=md-nav__item> <a href=../../development/HOW_TO_TEST/ class=md-nav__link> Testing </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/atlassian-labs/data-center-terraform/edit/main/docs/docs/troubleshooting/TROUBLESHOOTING.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=troubleshooting-tips>Troubleshooting tips<a class=headerlink href=#troubleshooting-tips title="Permanent link"> Â¶</a></h1> <p>This guide contains general tips on how to investigate an application deployment that doesn't work correctly.</p> <details class=tip> <summary>How do I uninstall an environment using a different Terraform configuration file?</summary> <p><strong>Symptom</strong></p> <p>If you try to uninstall an environment by using a different configuration file than the one you used to install it or by using a different version of the code, you may encounter some issues during uninstallation. In most cases, Terraform reports that the resource cannot be removed because it's in use.</p> <p><strong>Solution</strong></p> <p>Identify the resource and delete it manually from the AWS console, and then restart the uninstallation process. Make sure to always use the same configuration file that was used to install the environment. </p> </details> <details class=tip> <summary>How do I deal with persistent volumes that do not get removed as part of the Terraform uninstallation?</summary> <p><strong>Symptom</strong></p> <p>Uninstall fails to remove the persistent volume. <div class=highlight><pre><span></span><code>Error: Persistent volume atlassian-dc-share-home-pv still exists <span class=o>(</span>Bound<span class=o>)</span>

Error: context deadline exceeded

Error: Persistent volume claim atlassian-dc-share-home-pvc still exists with 
</code></pre></div> <strong>Solution</strong></p> <p>If a pod termination stalls, it will block pvc and pv deletion. To fix this problem we need to terminate product pod first and run uninstall command again. <div class=highlight><pre><span></span><code>kubectl delete pod &lt;stalled-pod&gt; -n atlassian --force
</code></pre></div> To see the stalled pod name you can run the following command: <div class=highlight><pre><span></span><code>kubectl get pods -n atlassian 
</code></pre></div></p> </details> <details class=tip> <summary>How do I deal with suspended AWS Auto Scaling Groups during Terraform uninstallation?</summary> <p><strong>Symptom</strong></p> <p>If for any reason Auto Scaling Group gets suspended, AWS does not allow Terraform to delete the node group. In cases like this the uninstall process gets interrupted with the following error:</p> <div class=highlight><pre><span></span><code>Error: error waiting <span class=k>for</span> EKS Node Group <span class=o>(</span>atlas-&lt;environment_name&gt;-cluster:appNode<span class=o>)</span> to delete: unexpected state <span class=s1>&#39;DELETE_FAILED&#39;</span>, wanted target <span class=s1>&#39;&#39;</span>. last error: <span class=m>2</span> errors occurred:
    * i-06a4b4afc9e7a76b0: NodeCreationFailure: Instances failed to join the kubernetes cluster
    * eks-appNode-3ebedddc-2d97-ff10-6c23-4900d1d79599: AutoScalingGroupInvalidConfiguration: Couldn<span class=err>&#39;</span>t terminate instances <span class=k>in</span> ASG as Terminate process is suspended
</code></pre></div> <p><strong>Solution</strong></p> <p>Delete the reported Auto Scaling Group in AWS console and run uninstall command again. </p> </details> <details class=tip> <summary>How do I deal with Terraform AWS authentication issues during installation?</summary> <p><strong>Symptom</strong></p> <p>The following error is thrown:</p> <div class=highlight><pre><span></span><code>An error occurred <span class=o>(</span>ExpiredToken<span class=o>)</span> when calling the GetCallerIdentity operation: The security token included <span class=k>in</span> the request is expired
</code></pre></div> <p><strong>Solution</strong></p> <p>Terraform cannot deploy resources to AWS if your security token has expired. Renew your token and retry.</p> </details> <details class=tip> <summary>How do I deal with Terraform state lock acquisition errors?</summary> <p>If user interrupts the installation or uninstallation process, Terraform won't be able to unlock resources. In this case, Terraform is unable to acquire state lock in the next attempt.</p> <p><strong>Symptom</strong></p> <p>The following error is thrown:</p> <div class=highlight><pre><span></span><code>Acquiring state lock. This may take a few moments...

 Error: Error acquiring the state lock

 Error message: ConditionalCheckFailedException: The conditional request failed
 Lock Info:
   ID:        26f7b9a8-1bef-0674-669b-1d60800dea4d
   Path:      atlassian-data-center-terraform-state-xxxxxxxxxx/bamboo-xxxxxxxxxx/terraform.tfstate
   Operation: OperationTypeApply
   Who:       xxxxxxxxxx@C02CK0JYMD6V
   Version:   <span class=m>1</span>.0.9
   Created:   <span class=m>2021</span>-11-04 <span class=m>00</span>:50:34.736134 +0000 UTC
   Info:
</code></pre></div> <p><strong>Solution</strong></p> <p>Forcibly unlock the state by running the following command:</p> <div class=highlight><pre><span></span><code>terraform force-unlock &lt;ID&gt;
</code></pre></div> <p>Where <code>&lt;ID&gt;</code> is the value that appears in the error message.</p> <p>There are two Terraform locks; one for the infrastructure and another for Terraform state. If you are still experiencing lock issues, change the directory to <code>./modules/tfstate</code> and retry the same command.</p> </details> <details class=tip> <summary>How do I deal with state data in S3 that does not have the expected content?</summary> <p>If Terraform state is locked and users forcefully unlock it using <code>terraform force-unlock &lt;id&gt;</code>, it may not get a chance to update the Digest value in DynamoDB. This prevents Terraform from reading the state data. </p> <p><strong>Symptom</strong></p> <p>The following error is thrown:</p> <div class=highlight><pre><span></span><code>Error refreshing state: state data <span class=k>in</span> S3 does not have the expected content.

This may be caused by unusually long delays <span class=k>in</span> S3 processing a previous state
update.  Please <span class=nb>wait</span> <span class=k>for</span> a minute or two and try again. If this problem
persists, and neither S3 nor DynamoDB are experiencing an outage, you may need
to manually verify the remote state and update the Digest value stored <span class=k>in</span> the
DynamoDB table to the following value: 531ca9bce76bbe0262f610cfc27bbf0b
</code></pre></div> <p><strong>Solution</strong></p> <ol> <li> <p>Open DynamoDB page in AWS console and find the table named <code>atlassian_data_center_&lt;region&gt;_&lt;aws_account_id&gt;_tf_lock</code> in the same region as the cluster.</p> </li> <li> <p>Click on <code>Explore Table Items</code> and find the LockID named <code>&lt;table_name&gt;/&lt;environment_name&gt;/terraform.tfstate-md5</code>. </p> </li> <li> <p>Click on the item and replace the <code>Digest</code> value with the given value in the error message.</p> </li> </ol> </details> <details class=tip> <summary>How do I deal with Pre-existing state in multiple environment?</summary> <p>If you start installing a new environment while you already have an active environment installed before, you should <em>NOT</em> use the pre-existing state. </p> <p>The same scenario when you want to uninstall a non-active environment. </p> <div class="admonition help"> <p class=admonition-title>What is active environment?</p> <p>Active environment is the latest environment you installed or uninstalled.</p> </div> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>Answer '<strong>NO</strong>' when you get a similar message during installation or uninstallation: <div class=highlight><pre><span></span><code>Do you want to copy existing state to the new backend? Pre-existing state was found while migrating 
the previous &quot;s3&quot; backend to the newly configured &quot;s3&quot; backend. An existing non-empty state already 
exists in the new backend. The two states have been saved to temporary files that will be removed 
after responding to this query. 

Do you want to overwrite the state in the new backend with the previous state? Enter &quot;yes&quot; to copy 
and &quot;no&quot; to start with the existing state in the newly configured &quot;s3&quot; backend.

Enter a value:
</code></pre></div></p> </div> <p><strong>Symptom</strong></p> <p>Installation or uninstallation break after you chose to use pre-existing state. </p> <p><strong>Solution</strong></p> <ol> <li>Clean up the project before proceed. In root directory of the project run: <div class=highlight><pre><span></span><code>./scripts/cleanup.sh -s -t -x -r .
terraform init -var-file<span class=o>=</span>&lt;config file&gt;
</code></pre></div></li> <li>Then re-run the install/uninstall script.</li> </ol> </details> <details class=tip> <summary>How do I deal with <code>Module not installed</code> error during uninstallation?</summary> <p>There are some Terraform specific modules that are required when performing an uninstall. These modules are generated by Terraform during the install process and are stored in the <code>.terraform</code> folder. If Terraform cannot find these modules, then it won't be able perform an uninstall of the infrastructure. </p> <p><strong>Symptom</strong></p> <div class=highlight><pre><span></span><code>Error: Module not installed

  on main.tf line <span class=m>7</span>:
   <span class=m>7</span>: module <span class=s2>&quot;tfstate-bucket&quot;</span> <span class=o>{</span>

This module is not yet installed. Run <span class=s2>&quot;terraform init&quot;</span> to install all modules required by this configuration.
</code></pre></div> <p><strong>Solution</strong></p> <ol> <li>In the root directory of the project run: <div class=highlight><pre><span></span><code>./scripts/cleanup.sh -s -t -x -r .
<span class=nb>cd</span> modules/tfstate
terraform init -var-file<span class=o>=</span>&lt;config file&gt;
</code></pre></div></li> <li>Go back to the root of the project and re-run the <code>uninstall.sh</code> script.</li> </ol> </details> <details class=tip> <summary>How to deal with <code>getting credentials: exec: executable aws failed with exit code 2</code> error?</summary> <p><strong>Symptom</strong></p> <p>After performing an <code>install.sh</code> the following error is encountered:</p> <div class=highlight><pre><span></span><code>Error: Post <span class=s2>&quot;https://0839E580E6ADB7B784AECE0E152D8AF2.gr7.eu-west-1.eks.amazonaws.com/api/v1/namespaces&quot;</span>: getting credentials: exec: executable aws failed with <span class=nb>exit</span> code <span class=m>2</span>

with module.base-infrastructure.kubernetes_namespace.products,
on modules/common/main.tf line <span class=m>39</span>, <span class=k>in</span> resource <span class=s2>&quot;kubernetes_namespace&quot;</span> <span class=s2>&quot;products&quot;</span>:
<span class=m>39</span>: resource <span class=s2>&quot;kubernetes_namespace&quot;</span> <span class=s2>&quot;products&quot;</span> <span class=o>{</span>
</code></pre></div> <p><strong>Solution</strong></p> <p>Ensure you are using a version of the <a href=https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html>aws cli</a> that is at least &gt;= <code>2</code> The version can be checked by running:</p> <div class=highlight><pre><span></span><code>aws --version
</code></pre></div> </details> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../../userguide/CLEANUP/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Uninstallation" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Uninstallation </div> </div> </a> <a href=../SUPPORT_BOUNDARIES/ class="md-footer__link md-footer__link--next" aria-label="Next: Support boundaries" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Support boundaries </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; [2021] to [2022] Atlassian and others. </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://community.atlassian.com/t5/Atlassian-Data-Center-on/gh-p/DC_Kubernetes target=_blank rel=noopener title=community.atlassian.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M152.2 236.4c-7.7-8.2-19.7-7.7-24.8 2.8L1.6 490.2c-5 10 2.4 21.7 13.4 21.7h175c5.8.1 11-3.2 13.4-8.4 37.9-77.8 15.1-196.3-51.2-267.1zM244.4 8.1c-122.3 193.4-8.5 348.6 65 495.5 2.5 5.1 7.7 8.4 13.4 8.4H497c11.2 0 18.4-11.8 13.4-21.7 0 0-234.5-470.6-240.4-482.3-5.3-10.6-18.8-10.8-25.6.1z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["search.suggest", "search.highlight", "navigation.instant", "navigation.tabs"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.bd0b6b67.min.js"}</script> <script src=../../assets/javascripts/bundle.467223ff.min.js></script> </body> </html>